#!/usr/bin/env bash

set -eufo pipefail

# Only run if age key doesn't exist
if [ -f "{{ .chezmoi.homeDir }}/.config/chezmoi/key.txt" ]; then
    exit 0
fi

# Create the directory
mkdir -p "{{ .chezmoi.homeDir }}/.config/chezmoi"

# Get the age key from ProtonPass using the protonPass template function
# This script will be called by chezmoi which will evaluate the template
echo "Age key file will be managed by chezmoi from ProtonPass"

chmod 600 "{{ .chezmoi.homeDir }}/.config/chezmoi/key.txt" 2>/dev/null || true

echo "âœ“ Age encryption key ready from ProtonPass"
